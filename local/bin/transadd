#!/bin/sh
T=$XDG_CONFIG_HOME/tr I=$PIX/transmission.svg

if ! pidof transmission-daemon >/dev/null; then
	transmission-daemon
	notify-send -i $I Transmission Starting...
	sleep 2
	transmission-remote --blocklist-update
fi

find "$T" -mtime +0 -exec rm {} \; 2>/dev/null

if ! test -s $T; then
	curl -sLZ https://cf.trackerslist.com/best.txt \
	| awk 'NF && !seen[$0]++' >$T
fi

for i do
	case $i in
	magnet:\?*)
		while read tr; do
			i="${i}&tr=${tr}"
		done <$T
	esac
	n=`transmission-remote -a "$i"`
	n=${n#*\"name\":\"} n=${n%\"*}
	notify-send -i $I 'Torrent added' "$n"
	pkill -12 status
done
