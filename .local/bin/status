#!/bin/sh
battery=$(echo /sys/class/power_supply/BAT?*)
wifi=$(echo /sys/class/net/w*/operstate)
bluetooth=$(echo /sys/class/bluetooth/hci0/rfkill*/state)
net_file=/tmp/net_stat; :> "$net_file"
trap "kill 0" EXIT
while :; do
	ping -c 1 -W 7 1.1.1.1 > /dev/null 2>&1 && echo 1 > "$net_file" || echo 0 > "$net_file"
	sleep 30
done &
while :; do
	time_date=$(date "+%d %b (%a), %R")
	read -r bt < "$bluetooth"; [ "$bt" -eq 1 ] && bt=on || bt=off
	read -r net < "$wifi"; read -r net_val < "$net_file"; [ "${net_val:-1}" -eq 0 ] && net="[ ! ] $net"
	while read -r key val _; do
		case $key in MemTotal:) total=$val;; MemAvailable:) available=$val;; esac
	done < /proc/meminfo ; mem=$(( (total - available) * 100 / total ))
	read -r cpu < /sys/class/thermal/thermal_zone0/temp; cpu="${cpu%000}Â°C"
	{ read -r _; read -r disk; } <<- EOF
	$(df / --output=pcent)
	EOF
	read -r batt_status < "$battery/status"
	if [ "$batt_status" != "Full" ]; then
		read -r capacity < "$battery/capacity"; [ "$capacity" -le 25 ] && capacity="ðŸª« $capacity"
		xsetroot -name "  BATT $capacity% ($batt_status)  |  DISK $disk  |  RAM $mem%  |  TEMP $cpu  |  BT $bt  |  NET $net  |  $time_date  "
	else
		xsetroot -name "  DISK $disk  |  RAM $mem%  |  TEMP $cpu  |  BT $bt  |  NET $net  |  $time_date  "
	fi
	sleep 10
done
