#!/bin/sh
while getopts vatidc: opt; do case $opt in
    v) cmd="yt-dlp -i -o ~/Videos/W/%(title)s-$(date +%s).%(ext)s" ;;
    a) cmd="yt-dlp --embed-metadata -x -f bestaudio -o ~/Music/%(title)s.%(ext)s" ;;
    t) cmd="yt-dlp --skip-download --write-thumbnail -o ~/Pictures/%(title)s.%(ext)s" ;;
    i) cmd="gallery-dl --cookies-from-browser firefox -d ~/Pictures" ;;
    d) cmd="aria2c --dir=${HOME}/Videos/Watchlist"; o=$opt ;;
    c) cmd=$OPTARG; o=$opt ;;
esac done
shift $((OPTIND - 1))
url=${1:-$(xclip -o)}
name="${url##*/}"
case "$o" in [cd]) name="${name%%\?*}"; esac
notify-send -i "$PIX/dlpending.svg" "Queuing download" "$name"
id="$(tsp $cmd "$url")"
pkill -10 status
( tsp -w "$id" && notify-send -i "$PIX/dlcomplete.svg" "Download complete" "$name" ||
	notify-send -u critical "‚ùó Download failed" "$name"; pkill -10 status
) &
