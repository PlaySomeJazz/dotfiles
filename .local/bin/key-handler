#!/bin/sh
while read -r file; do case "$1" in
w)	setbg "$file" & ;;
s)
	dest=$(sed -e 's/\s*#.*//' -e '/^$/d' -e 's/^\S*\s*//' "${XDG_CONFIG_HOME:-$HOME/.config}/shell/bm-dirs" | dmenu -l 20 -i -p "Copy" | sed "s|~|$HOME|g")
	[ -z "$dest" ] && exit || dest=$(eval printf '%s\\n' \"$dest\") && [ ! -d "$dest" ] && notify-send "$dest is not a directory" && exit ||
	safe cp "$file" "$dest" && notify-send -i "$(readlink -f "$file")" "Image copied to $dest" & ;;
m)
	dest=$(sed -e 's/\s*#.*//' -e '/^$/d' -e 's/^\S*\s*//' "${XDG_CONFIG_HOME:-$HOME/.config}/shell/bm-dirs" | dmenu -l 20 -i -p "Move" | sed "s|~|$HOME|g")
	[ -z "$dest" ] && exit && dest=$(eval printf '%s\\n' \"$dest\") && [ ! -d "$dest" ] && notify-send "$dest is not a directory" && exit ||
	safe mv "$file" "$dest" && notify-send -i "$(readlink -f "$file")" "Image moved to $dest" & ;;
r)
	magick "$file" -rotate 90 "$file" ;;
R)
	magick "$file" -rotate -90 "$file" ;;
f)
	magick "$file" -flop "$file" ;;
c)
	xclip -selection clipboard -target image/png "$file" && notify-send "Image copied to clipboard" & ;;
y)
	printf "%s" "${file##*/}" | xclip -selection clipboard && notify-send "Filename copied to clipboard" & ;;
Y)
	readlink -f "$file" | xclip -selection clipboard && notify-send "File path copied to clipboard" & ;;
d)
	[ "$(printf "Yes\nNo\n" | dmenu -i -p "Delete selection?")" = "Yes" ] && rm "$file" && notify-send "$file" "File deleted." ;;
g)
	setsid -f gimp "$file" ;;
i)
	notify-send "File information" "$(mediainfo "$file" | sed "s/[ ]\+:/:/g;s/: /: <b>/;s/$/<\/b>/" | grep "<b>")" ;;
esac; done
