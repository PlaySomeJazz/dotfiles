#!/bin/sh

source_dir="/media_files/torrents"
for i in $HOME/Videos/Watchlist $HOME/Music; do [ ! -d "$i" ] && mkdir -p "$i"; done

# Move videos to watchlist
find "$source_dir" -type f \( -iname "*.mp4" -o -iname "*.mkv" \) -exec sh -c 'safe mv "$@" $HOME/Videos/Watchlist/' sh {} +

# Move directories containing audio into Music
for dir in "$source_dir"/*/; do dir="${dir%/}"; [ -n "$(find "$dir" -type f \( -iname "*.mp3" -o -iname "*.m4b" -o -iname "*.flac" -o -iname "*.m4a" -o -iname "*.opus" \) -print -quit)" ] && safe mv "$dir" "$HOME/Music"; done

# Delete directories with no files of these types
find "$source_dir" -depth \( ! -path "$source_dir" -prune \) -type d -exec sh -c 'while read -r dir; do [ -z "$(find "$dir" -type f \( -iname "*.pdf" -o -iname "*.djvu" -o -iname "*.epub" -o -iname "*.mobi" -o -iname "*.zip" -o -iname "*.rar" \) -print -quit)" ] && rm -rf "$dir"; done' sh {} +

# Send a notification
notify-send "Done" "Your files are sorted"
